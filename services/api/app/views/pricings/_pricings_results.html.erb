<%= form_with url: store_pricings_path(Current.store), method: :get,
  data: {
    turbo_frame: 'pricings_results',
    turbo_action: 'advance',
    controller: 'submit',
    action: 'input->submit#submit'
  } do |f| %>
  <%= content_tag :div, class: 'flex flex-col gap-4 rounded-lg border border-gray-400 bg-white p-4 md:flex-row md:items-center md:justify-between mb-8 ' do %>
    <%= content_tag :div, class: 'relative w-full sm:max-w-xs' do %>
      <%= f.search_field :name, value: params[:name], autocomplete: 'name', placeholder: 'Search galleries...', class: 'bg-white p-2 rounded-md font-medium text-sm border border-gray-400 hover:bg-gray-100' %>
    <% end %>
  <% end %>
<% end %>

<% if @galleries.any? %>
  <%= content_tag :div, class: 'space-y-4' do %>
    <% @galleries.each do |gallery| %>
      <%= content_tag :details, class: 'rounded-lg border border-gray-400 bg-stone-100 shadow-sm overflow-hidden group/details' do %>
        <%= content_tag :summary, class: 'flex flex-col space-y-1.5 p-6 cursor-pointer bg-stone-100 py-4' do %>
          <%= content_tag :div, class: 'flex items-center justify-between' do %>
            <%= content_tag :div, class: 'flex items-center gap-2' do %>
              <%= icon 'chevron-down', class: 'size-4' %>
              <%= content_tag :h3, gallery.name, class: 'text-lg font-medium' %>
              <%= gallery_badge_status(gallery) %>
            <% end %>
            <%= content_tag :div, class: 'flex items-center gap-2' do %>
              <%= content_tag :span, "#{gallery.packages.count} packages,", class: 'text-sm text-gray-500' %>
              <%= content_tag :span, "#{gallery.add_ons.count} add-ons", class: 'text-sm text-gray-500' %>
            <% end %>
          <% end %>
        <% end %>

        <%= content_tag :div, class: 'p-6 pt-6 bg-white' do %>
          <%= content_tag :div, data: { controller: :tabs, tabs_active_class: 'bg-gray-900 text-gray-100', tabs_default_tab_value: 'packages' } do %>
            <%= content_tag :div, class: "inline-flex h-10 items-center justify-center rounded-md bg-gray-200 p-1 text-gray-500 mb-4" do %>
              <%= content_tag :button, "Packages", id: "packages", class: 'inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium cursor-pointer', data: { tabs_target: "btn", action: "click->tabs#select" } %>
              <%= content_tag :button, "Add-ons", id: "add-ons", class: 'inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium cursor-pointer', data: { tabs_target: "btn", action: "click->tabs#select" } %>
            <% end %>

            <%= content_tag :div, id: 'packages', data: { tabs_target: 'tab'} do %>
              <%= content_tag :div, class: 'mt-2 space-y-4' do %>
                <%= content_tag :div, class: 'flex justify-between items-center mb-4' do %>
                  <%= content_tag :h4, 'Packages', class: 'text-lg font-medium' %>
                  <%= link_to new_store_gallery_path(Current.store), class: 'inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium [&_svg]:size-4 h-10 px-4 py-2 bg-[oklch(66.14%_0.0661_72.71)] hover:bg-[oklch(60%_0.0661_72.71)] text-white', data: { turbo_frame: '_top' } do %>
                    <%= icon 'plus' %>
                    <%= content_tag :span, 'Add Package' %>
                  <% end %>
                <% end %>

                <%= content_tag :div, class: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4' do %>
                  <% if gallery.packages.any? %>
                    <% gallery.packages.each do |package| %>
                      <%= content_tag :div, class: 'rounded-lg border border-gray-400 bg-white shadow-sm relative' do %>
                        <% if package.popular? %>
                          <%= content_tag :div, 'Popular', class: 'absolute top-0 right-0 bg-[oklch(66.14%_0.0661_72.71)] text-white text-xs font-bold px-3 py-1 rounded-bl-lg' %>
                        <% end %>
                        <%= content_tag :div, class: 'flex flex-col space-y-1.5 p-6 pb-2' do %>
                          <%= content_tag :div, class: 'flex justify-between items-start' do %>
                            <%= content_tag :h3, package.name, class: 'text-2xl font-semibold leading-none tracking-tight' %>
                            <%= link_to edit_store_gallery_path(Current.store, gallery), data: { turbo_frame: '_top' } do %>
                              <%= icon 'pencil-square', class: 'size-5 text-blue-500 hover:text-blue-800' %>
                            <% end %>
                          <% end %>

                          <%= content_tag :p, "$#{package.price}", class: 'text-sm text-gray-500 flex items-center mt-1' %>
                        <% end %>

                        <%= content_tag :div, class: 'p-6 pt-0' do %>
                          <%= content_tag :div, class: 'flex items-center gap-2 text-sm text-gray-500 mb-2' do %>
                            <%= icon 'clock', class: 'size-4' %>
                            <%= content_tag :span, package.formatted_duration %>
                            <%= content_tag :span, 'â€¢', class: 'mx-1' %>
                            <%= content_tag :span, "#{package.edited_images} edited images" %>
                          <% end %>

                          <%= content_tag :ul, class: 'space-y-1' do %>
                            <% package.features.each do |feature| %>
                              <%= content_tag :li, class: 'flex items-start gap-2 text-sm' do %>
                                <%= icon 'check', class: 'text-green-500 size-4' %>
                                <%= content_tag :span, feature %>
                              <% end %>
                            <% end %>
                          <% end %>
                        <% end %>
                      <% end %>
                    <% end %>
                  <% else %>
                    <%= content_tag :div, class: 'col-span-3 flex flex-col items-center justify-center text-center p-6' do %>
                      <%= content_tag :h4, 'No existing packages yet in this gallery.', class: 'text-lg mb-2' %>
                      <%= content_tag :p, 'To create your first package, please click on the New package button above.', class: 'text-sm text-gray-500 mb-4' %>
                    <% end %>
                  <% end %>
                <% end %>
              <% end %>
            <% end %>

            <%= content_tag :div, class: 'hidden', id: 'add-ons', data: { tabs_target: 'tab'} do %>
              <%= content_tag :div, class: 'mt-2 space-y-4' do %>
                <%= content_tag :div, class: 'flex justify-between items-center mb-4' do %>
                  <%= content_tag :h4, 'Add Ons', class: 'text-lg font-medium' %>
                  <%= link_to new_store_gallery_path(Current.store), class: 'inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium [&_svg]:size-4 h-10 px-4 py-2 bg-[oklch(66.14%_0.0661_72.71)] hover:bg-[oklch(60%_0.0661_72.71)] text-white', data: { turbo_frame: '_top' } do %>
                    <%= icon 'plus' %>
                    <%= content_tag :span, 'Add Add-On' %>
                  <% end %>
                <% end %>

                <% if gallery.add_ons.any? %>
                  <%= content_tag :div, class: 'overflow-hidden border border-gray-400 rounded-md' do %>
                    <%= content_tag :table, class: 'w-full' do %>
                      <%= content_tag :thead do %>
                        <%= content_tag :tr, class: 'border-b border-gray-300 bg-stone-200' do %>
                          <%= content_tag :th, 'Name', class: 'px-4 py-3 text-left' %>
                          <%= content_tag :th, 'Price', class: 'px-4 py-3 text-left' %>
                          <%= content_tag :th, 'Limited', class: 'px-4 py-3 text-left' %>
                          <%= content_tag :th, 'Actions', class: 'px-4 py-3 text-left' %>
                        <% end %>
                      <% end %>

                      <%= content_tag :tbody do %>
                        <% gallery.add_ons.each do |add_on| %>
                          <%= content_tag :tr, class: 'border-b border-gray-300 odd:bg-white even:bg-stone-100' do %>
                            <%= content_tag :td, add_on.name, class: 'px-4 py-3'%>

                            <%= content_tag :td, "$#{add_on.price}", class: 'px-4 py-3' %>

                            <%= content_tag :td, add_on.limited? ? 'yes' : 'no', class: 'px-4 py-3 text-gray-500' %>

                            <%= content_tag :td, class: 'px-4 py-3' do %>
                              <%= content_tag :div, class: 'flex gap-2' do %>
                                <%= link_to store_customer_path(Current.store, add_on), data: { turbo_frame: '_top' } do %>
                                  <%= icon 'eye', class: 'size-5 text-gray-500 hover:text-gray-800' %>
                                <% end %>
                                <%= button_to store_gallery_path(Current.store, gallery),
                                  method: :delete,
                                  data: { turbo_confirm: 'Are you sure you want to delete this add-on?' } do %>
                                  <%= icon 'trash', class: 'size-5 text-red-500 hover:text-red-800 cursor-pointer' %>
                                <% end %>
                              <% end %>
                            <% end %>
                          <% end %>
                        <% end %>
                      <% end %>
                    <% end %>
                  <% end %>
                <% else %>
                  <%= content_tag :div, class: 'col-span-3 flex flex-col items-center justify-center text-center p-6' do %>
                    <%= content_tag :h4, 'No existing add-ons yet in this gallery.', class: 'text-lg mb-2' %>
                    <%= content_tag :p, 'To create your first add-on, please click on the New Add-On button above.', class: 'text-sm text-gray-500 mb-4' %>
                  <% end %>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
<% else %>
  <%= content_tag :div, class: 'p-4 text-center' do %>
    <%= content_tag :h3, 'No existing galleries yet in your store.', class: 'text-lg font-semibold mb-2' %>
  <% end %>
<% end %>
